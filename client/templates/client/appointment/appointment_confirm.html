{% extends 'client/client.html' %}
{% load static %}

{% block main %}
<div class='Container'>
    <h1>Book Appointment</h1>

        <h3>Client</h3>
        <p>{{user.first_name}}  {{user.last_name}}</p>
        <h3>Date</h3>
        <p>{{data.date}}</p>
        <h3>description</h3>
        <p>{{data.description}}</p>
        {% for test in data.tests_requested %}
            <h3>Test {{ forloop.counter }}</h3>
            <p>{{test.name}}</p>
        {% endfor %}
        <h3>Total Price of current tests</h3>
        <p>{{data.total_price}}$ USD</p>
        <h3>Price of Appointment Booking</h3>
        <p>20.00$ USD</p>
        <small style="font-size:12px;">note: Excluding the Appointment Visit Fees</small>
        <h3>Document</h3>
        {% if data.document is not None %}
            <img src="/media/{{data.document}}" width='200' height="200">
        {% else %}
            <p>No Document provided.</p>
        {% endif %}
        

        <form method="POST">
            {% csrf_token %}

            <h2>Choose your Payment Method</h2>
            <select name="payment_option">
                <option value="PP">Pre-pay</option>
                <option value="OR" selected>On-Receive</option>
            </select>


            <input type="hidden" name="data.client" value="{{ data.client.id }}">
            <input type="hidden" name="data.date" value="{{ data.date }}">
            <input type="hidden" name="data.description" value="{{ data.description }}">
            {% if data.document is not None %}
                <input type="hidden" name="data.document" value="{{ data.document }}">
            {% endif %}
            <input type="hidden" name="data.test_count" value="{{ data.tests_requested.count }}">
            {% for test in data.tests_requested %}
                <input type="hidden" name="data.tests_requested{{forloop.counter}}" value="{{ test.id }}">
            {% endfor %}
            <input type="hidden" name="data.total_price" value="{{ data.total_price }}">

            <div id="paypal-button-container"></div>

            <button type="submit">Book Without Payment</button>
        </form>

</div>


{% endblock main %}

{% block scripts_3 %}


<script src="https://www.paypal.com/sdk/js?client-id=AedI_3BVqb2iK2jXTYxxmcbKWHvdipYhZQYFPxfaq-6_XxiKvnjuSd6cyriyOOrybkLx8E8sEAYi5cFy&components=buttons&currency=USD&disable-funding=credit,card"></script>
<script>
    paypal.Buttons({

        // Set up the transaction
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '10.00' 
                    }
                }]
            });
        },
        // Finalize the transaction
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                // Handle the successful transaction
                console.log(details);
                alert("Transaction Complete! $10.00 USD Paid");
                // You can perform additional actions here, such as showing a success message or redirecting to a success page
            });
        },
    
        // Handle errors or cancellations
        onError: function(err) {
            console.log(err);
            // You can display an error message or perform other error handling actions here
        },
        
        style: {
            color: 'blue',
            shape: 'rect',
        },
        locale: 'en_US',
    }).render('#paypal-button-container');
</script>
{% endblock scripts_3 %}